<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ContentEditable Paragraph Creator</title>
</head>
<body>
    <h3>Rich Text Editor</h3>
    <div id="editor" contenteditable="true"><p><br></p></div>
    
    <script>
        const editor = document.getElementById('editor');
        
        // Initialize with a paragraph if empty
        if (editor.innerHTML.trim() === '') {
            editor.innerHTML = '<p><br></p>';
        }
        
        editor.addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                event.preventDefault(); // Prevent default Enter behavior
                
                // Get current selection
                const selection = window.getSelection();
                const range = selection.getRangeAt(0);
                
                // Find the current paragraph
                let currentParagraph = range.startContainer;
                
                // Navigate up to find the paragraph element
                while (currentParagraph && currentParagraph.nodeName !== 'P') {
                    if (currentParagraph.parentNode === editor) {
                        // If we're directly in the editor and not in a paragraph,
                        // wrap the content in a paragraph
                        const newP = document.createElement('p');
                        range.surroundContents(newP);
                        currentParagraph = newP;
                        break;
                    }
                    currentParagraph = currentParagraph.parentNode;
                }
                
                // Create a new paragraph
                const newParagraph = document.createElement('p');
                newParagraph.innerHTML = '<br>'; // Ensures the paragraph has height even when empty
                
                // If the cursor is at the end of the paragraph, add the new paragraph after
                // Otherwise, split the content
                if (range.endOffset === (currentParagraph.textContent || '').length && 
                    range.endContainer === currentParagraph.childNodes[0]) {
                    currentParagraph.after(newParagraph);
                } else {
                    // Split content
                    const secondHalf = range.extractContents();
                    newParagraph.appendChild(secondHalf);
                    currentParagraph.after(newParagraph);
                    
                    // If original paragraph is now empty, ensure it has content
                    if (currentParagraph.innerHTML === '') {
                        currentParagraph.innerHTML = '<br>';
                    }
                }
                
                // Focus on the new paragraph
                range.selectNodeContents(newParagraph);
                range.collapse(true); // Move cursor to the beginning
                selection.removeAllRanges();
                selection.addRange(range);
            }
        });
    </script>
</body>
</html>